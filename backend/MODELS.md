# Модели данных

## Структура данных

### Account (Аккаунт)
- `accountId` (String, уникальный): `acc_XXXXXX` - ID аккаунта
- `name` (String, обязательный): Название аккаунта
- `createdAt` (Date): Дата создания
- `updatedAt` (Date): Дата обновления

**Описание:** Аккаунт представляет собой организацию или компанию, которая использует систему. В системе может быть несколько десятков аккаунтов.

---

### User (Пользователь)
- `accountId` (String, обязательный): ID аккаунта, к которому принадлежит пользователь
- `userId` (String, уникальный): `usr_XXXXXXXX` - ID пользователя
- `phone` (String, обязательный): Номер телефона в формате `79XXXXXXXXX`
- `name` (String, обязательный): Имя пользователя
- `verificationCode` (Object): Код верификации SMS
  - `code` (String): Код
  - `expiresAt` (Date): Срок действия
- `createdAt` (Date): Дата создания
- `lastActiveAt` (Date): Последняя активность

**Ограничения:**
- Один пользователь не может принадлежать нескольким аккаунтам
- Составной уникальный индекс: `accountId + phone` (один телефон может быть в разных аккаунтах, но не дважды в одном аккаунте)

---

### Contact (Контакт)
- `accountId` (String, обязательный): ID аккаунта, к которому принадлежит контакт
- `contactId` (String, уникальный): `cnt_XXXXXXXXX` - ID контакта
- `name` (String, обязательный): Имя контакта
- `phone` (String, обязательный): Номер телефона в формате `79XXXXXXXXX`
- `createdAt` (Date): Дата создания
- `updatedAt` (Date): Дата обновления

**Описание:** Контакты - это бизнес-клиенты, с которыми пользователи будут переписываться через frontend чата. Сообщения будут отправляться и получаться через внешние системы через API каналов.

**Ограничения:**
- Составной индекс: `accountId + phone` (для быстрого поиска)

---

### Channel (Канал)
- `accountId` (String, обязательный): ID аккаунта, к которому принадлежит канал
- `channelId` (String, уникальный): `chn_XXXXXX` - ID канала
- `type` (String, обязательный): Тип канала (`whatsapp`, `telegram`, `viber`, `sms`)
- `instanceId` (String, обязательный): ID экземпляра во внешней системе
- `token` (String, обязательный): Токен для доступа к API канала
- `isActive` (Boolean): Активен ли канал (по умолчанию `true`)
- `createdAt` (Date): Дата создания
- `updatedAt` (Date): Дата обновления

**Описание:** Каналы - это учетные записи внешних API систем (WhatsApp, Telegram и т.д.), которые могут отправлять и принимать сообщения с бизнес-клиентами.

**Ограничения:**
- Составной индекс: `accountId + type` (для фильтрации каналов по аккаунту и типу)

---

## Связи между моделями

```
Account (1) ──< (N) User
Account (1) ──< (N) Contact
Account (1) ──< (N) Channel
```

- Один аккаунт может иметь множество пользователей
- Один аккаунт может иметь множество контактов
- Один аккаунт может иметь множество каналов
- Пользователь принадлежит только одному аккаунту
- Контакт принадлежит только одному аккаунту
- Канал принадлежит только одному аккаунту

---

## AdminJS

Админ-панель доступна по адресу: `http://localhost:3001/admin`

В админ-панели можно:
- Просматривать все модели данных
- Создавать, редактировать и удалять записи
- Фильтровать и искать записи
- Просматривать детальную информацию о записях

---

## Миграции

⚠️ **Важно:** При обновлении существующей базы данных необходимо:
1. Создать аккаунты для существующих пользователей
2. Назначить `accountId` для всех существующих пользователей
3. Убедиться, что составные индексы созданы правильно

