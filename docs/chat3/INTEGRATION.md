# ü§ù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º —Å Chat3

–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∫–æ–º–∞–Ω–¥, –ø–æ–¥–∫–ª—é—á–∞—é—â–∏—Ö —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∫ Chat3. –î–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–¥—Ä—è–¥—á–∏–∫–∞–º ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª ‚Äî –æ–Ω –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤–µ—Å—å —Å—Ç–µ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

---

## üìò –û–±–∑–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

- **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (—Ç–µ–Ω–∞–Ω—Ç—ã, –¥–∏–∞–ª–æ–≥–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å—ã, —Ä–µ–∞–∫—Ü–∏–∏, –º–µ—Ç–∞-—Ç–µ–≥–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏).
- **Event-driven –º–æ–¥–µ–ª—å**: –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ –∏ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ RabbitMQ.
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (Updates) –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π –ø–æ `userId`.
- **–ì–∏–±–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º –ø–æ–ª—è–º.
- **–ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å**: –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API –∫–ª—é—á–∏ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ `tenantId`.
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é**: Docker, RabbitMQ, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã.

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### API –∫–ª—é—á–∏ –∏ –ø—Ä–∞–≤–∞

- –ö–∞–∂–¥—ã–π HTTP –∑–∞–ø—Ä–æ—Å –∫ REST API –æ–±—è–∑–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-api-key`.
- –ö–ª—é—á–∏ –≤—ã–¥–∞—é—Ç—Å—è –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç –∏ –Ω–µ—Å—É—Ç –ø—Ä–∞–≤–∞:
  - `read` ‚Äî –∑–∞–ø—Ä–æ—Å—ã `GET`.
  - `write` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ `POST`, `PUT`, `PATCH`.
  - `delete` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ `DELETE`.
- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –ø—Ä–∞–≤–∞ –≤–µ—Ä–Ω—ë—Ç—Å—è `403 Forbidden`.
- –ö–ª—é—á–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ AdminJS (`/admin`) –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã:
  - `node scripts/generateApiKey.js`
  - `node scripts/generateDemoApiKey.js`

### –ë–∞–∑–æ–≤—ã–µ URL –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

- REST API: `http://localhost:3000/api` (–≤ production ‚Äî HTTPS).
- Admin –ø–∞–Ω–µ–ª—å: `http://localhost:3000/admin`.
- RabbitMQ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): `amqp://rmuser:rmpassword@localhost:5672/`.
- Worker: `node src/workers/updateWorker.js` (–∏–ª–∏ `./start-worker.sh`).

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|------------|------------------------|
| `MONGODB_URI` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB | `mongodb://localhost:27017/chat3` |
| `RABBITMQ_HOST` | –•–æ—Å—Ç RabbitMQ | `localhost` |
| `RABBITMQ_PORT` | –ü–æ—Ä—Ç RabbitMQ | `5672` |
| `RABBITMQ_USER` / `RABBITMQ_PASSWORD` | –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | `rmuser` / `rmpassword` |
| `RABBITMQ_VHOST` | –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç | `/` |
| `RABBITMQ_URL` | –ü–æ–ª–Ω—ã–π URL (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª—è –≤—ã—à–µ) | ‚Äî |
| `RABBITMQ_EXCHANGE_EVENTS` | Exchange —Å–æ–±—ã—Ç–∏–π | `chat3_events` |
| `RABBITMQ_EXCHANGE_UPDATES` | Exchange –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π | `chat3_updates` |

### –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

- –í—Å–µ payload'—ã –∏ –æ—Ç–≤–µ—Ç—ã ‚Äî JSON (UTF-8).
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã ‚Äî —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ MongoDB `ObjectId` (`64fa1cca6f...`).
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ ‚Äî ISO-8601 (UTC) –∏–ª–∏ —á–∏—Å–ª–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ Unix.
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Joi; –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `400 Bad Request` —Å –¥–µ—Ç–∞–ª—è–º–∏.

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- `400` ‚Äî –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä.
- `401` ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç API –∫–ª—é—á.
- `403` ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤.
- `404` ‚Äî —Å—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –ª–∏–±–æ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–∫—É—â–µ–º—É tenant.
- `409` ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞).
- `422` ‚Äî –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è).
- `500` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å backoff).

---

## üåê REST API

### –ö–∞—Ç–∞–ª–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –¢—Ä–µ–±—É–µ–º—ã–µ –ø—Ä–∞–≤–∞ |
|-----------|----------|----------|-----------------|
| Tenants | `GET/POST/PUT/DELETE /tenants` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏). | read/write/delete |
| Dialogs | `GET /dialogs` | –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π; —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è, –ø–æ–ª–µ `memberCount` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. | read |
| Dialogs | `POST /dialogs` | –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞, —É–∫–∞–∑–∞–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤. | write |
| Dialogs | `GET /dialogs/:dialogId` | –î–µ—Ç–∞–ª–∏ –¥–∏–∞–ª–æ–≥–∞ –∏ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±–µ–∑ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤; –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ–ª–µ `memberCount`. | read |
| Dialogs | `GET /dialogs/:dialogId/members` | –ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ `queryParser` –∏ `meta.*`. | read |
| Dialogs | `DELETE /dialogs/:dialogId` | –£–¥–∞–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞. | delete |
| Dialog Members | `POST /dialogs/{dialogId}/member/{userId}/typing` | –°–∏–≥–Ω–∞–ª "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç" (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω 1‚ÄØ—Å). | write |
| Messages | `GET /dialogs/:dialogId/messages` | –°–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏. | read |
| Messages | `POST /dialogs/:dialogId/messages` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (`content`, `type`, `meta`, `quotedMessageId`). | write |
| Messages | `GET /messages` | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤—Å–µ –¥–∏–∞–ª–æ–≥–∏). | read |
| Message Status | `POST /messages/:messageId/status/:userId/:status` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ (`unread`, `delivered`, `read`). | write |
| Message Reactions | `GET /messages/:messageId/reactions` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π. | read |
| Message Reactions | `POST /messages/:messageId/reactions` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏. | write |
| Message Reactions | `DELETE /messages/:messageId/reactions/:reactionId` | –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏. | delete |
| Dialog Members | `POST /dialogs/:dialogId/members/:userId/add` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞. | write |
| Dialog Members | `POST /dialogs/:dialogId/members/:userId/remove` | –£–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞. | delete |
| Dialog Members | `PATCH /dialogs/:dialogId/members/:userId/unread` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å `unreadCount` (–æ—Ç–º–µ—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏). | write |
| Users | `GET /users` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π; `includeDialogCount=true` –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫ –¥–∏–∞–ª–æ–≥–æ–≤; `filter` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `(–ø–æ–ª–µ,–æ–ø–µ—Ä–∞—Ç–æ—Ä,–∑–Ω–∞—á–µ–Ω–∏–µ)` (—á–µ—Ä–µ–∑ `queryParser`) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `userId`, `name`, `meta.*`. | read |
| Users | `GET /users/:userId/dialogs` | –î–∏–∞–ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏. | read |
| Meta | `GET/PUT/DELETE /meta/:entityType/:entityId/:key` | –†–∞–±–æ—Ç–∞ —Å –º–µ—Ç–∞-—Ç–µ–≥–∞–º–∏ –ª—é–±–æ–π —Å—É—â–Ω–æ—Å—Ç–∏. | read/write/delete |

> –ü–æ–ª–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª–µ–π –∏ –ø—Ä–∏–º–µ—Ä—ã —Å–º. –≤ `docs/API.md` (REST) –∏ `docs/FILTER_RULES.md` (—Ñ–∏–ª—å—Ç—Ä—ã).

- –û—Ç–≤–µ—Ç—ã `GET /messages` –∏ `GET /dialogs/:dialogId/messages` —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–±—ä–µ–∫—Ç `senderInfo`, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å `senderId` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –í —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Ö–æ–¥—è—Ç `userId`, `name`, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏ `meta` (–≤—Å–µ –º–µ—Ç–∞-—Ç–µ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞

- `GET /api/dialogs/:dialogId` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –¥–∏–∞–ª–æ–≥–∞ –∏ –µ–≥–æ `meta`.
- –î–ª—è —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `GET /api/dialogs/:dialogId/members?page=1&limit=50&filter=(role,eq,agent)`.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `queryParser`, –≤–∫–ª—é—á–∞—è `meta.*` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `(meta.shift,eq,day)`), –∞ —Ç–∞–∫–∂–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `joinedAt`, `lastSeenAt`, `lastMessageAt`, `unreadCount`, `userId`, `role`, `isActive`.
- –°–±—Ä–æ—Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã: `PATCH /api/dialogs/:dialogId/members/:userId/unread` —Å `{"unreadCount":0}` (–∏–ª–∏ –ª—é–±—ã–º —á–∏—Å–ª–æ–º <= —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞). –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è `lastSeenAt` (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã) –∏ `reason` –¥–ª—è –∞—É–¥–∏—Ç–∞.

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è

- –ü–∞–≥–∏–Ω–∞—Ü–∏—è: `page` (>=1, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1), `limit` (1‚Äì100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20).
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: `sort[field]=asc|desc`. –î–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä.
- –§–∏–ª—å—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ JSON-—Å—Ç—Ä–æ–∫–∏ –≤ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö. –ü—Ä–∏–º–µ—Ä—ã:
  - `GET /dialogs?member={"$all":["agent_1","agent_2"]}`
  - `GET /dialogs?meta.channelType={"$in":["whatsapp","telegram"]}`
  - `GET /dialogs?unreadCount={"$gte":5}`
- –î–æ–ø—É—Å—Ç–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã: `$eq`, `$ne`, `$in`, `$nin`, `$all`, `$gte`, `$gt`, `$lte`, `$lt`, `$exists`, `regex`, `exact`.
- –û–±—ä–µ–∫—Ç `meta` –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –∫–ª—é—á–∞–º (`meta.channelType`).
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–ª–µ –∏–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤—ã–∑–æ–≤–µ—Ç `400` —Å —Ç–µ–∫—Å—Ç–æ–º `Invalid filter parameter`.
- –î–ª—è `GET /users` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–∞–∫–æ–π –∂–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `filter`, –∫–∞–∫ –≤ `GET /dialogs`. –ü—Ä–∏–º–µ—Ä—ã: `(userId,regex,carl)`; `(name,eq,Alice)`; `(meta.role,eq,manager)`; `(userId,regex,bot)&(meta.region,regex,europe)`.

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞

- `POST /dialogs/{dialogId}/member/{userId}/typing` —Å–æ–æ–±—â–∞–µ—Ç –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –¥–∏–∞–ª–æ–≥–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å.
- –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –ø—É—Å—Ç–æ–µ. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∞ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ (`write`).
- –≠–Ω–¥–ø–æ–∏–Ω—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 1‚ÄØ—Å–µ–∫—É–Ω–¥—ã, –ø–æ—ç—Ç–æ–º—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –µ–≥–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äî 700‚Äì1000‚ÄØ–º—Å).
- –í –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç `202 Accepted` –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π `expiresInMs` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5000‚ÄØ–º—Å), —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç—ã –∑–Ω–∞–ª–∏, –∫–æ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤.
- –°–æ–±—ã—Ç–∏–µ `dialog.typing` –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ RabbitMQ (`chat3_events`), –ø–æ—Å–ª–µ —á–µ–≥–æ Update Worker —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `Typing`-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (routing key `user.{userId}.typing`) –≤ `chat3_updates`. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞ –∫–ª–∏–µ–Ω—Ç—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞—é—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ `isTyping: false` –Ω–µ—Ç.

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –≤–ª–æ–∂–µ–Ω–∏–π

- –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç—Ä–∏ —Å–µ–º–µ–π—Å—Ç–≤–∞ —Ç–∏–ø–æ–≤:
  - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ (`internal.*`): `internal.text`, `internal.image`, `internal.file`, `internal.audio`, `internal.video`, `internal.location`, `internal.contact`.
  - –°–∏—Å—Ç–µ–º–Ω—ã–µ (`system.*`): –ª—é–±–∞—è —Å—Ç—Ä–æ–∫–∞, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è `system.<slug>` (–ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã, –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ—á–∫–∞, –¥–µ—Ñ–∏—Å, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `system.text`, `system.announcement`).
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ (`user.*`): –ª—é–±—ã–µ, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `user.<slug>` (–ª–∞—Ç–∏–Ω–∏—Ü–∞/—Ü–∏—Ñ—Ä—ã, –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ—á–∫–∞, –¥–µ—Ñ–∏—Å, –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ).

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è `internal.*`

| –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ |
|-----|-------------------|---------------|
| `internal.text` | `senderId`, `content` (1‚Äì10‚ÄØ000 —Å–∏–º–≤–æ–ª–æ–≤) | `meta` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω, `quotedMessageId` –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω |
| `internal.image` | `senderId`, `meta.url` | `content` ‚Äî –ø–æ–¥–ø–∏—Å—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), `meta` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `mimeType`, `size`, `width`, `height` –∏ —Ç.–¥. |
| `internal.file` | `senderId`, `meta.url` | `content` ‚Äî –ø–æ–¥–ø–∏—Å—å, `meta` –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å `mimeType`, `size`, `fileName` |
| `internal.video` | `senderId`, `meta.url` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ `meta.previewUrl`, `duration` –∏ —Ç.–¥. |
| `internal.audio` | `senderId`, `meta.url` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ `meta.duration`, `meta.waveform` –∏ –¥—Ä. |

> ‚ÑπÔ∏è –°–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–∏–ø–æ–º `system.*` —Å—á–∏—Ç–∞—é—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏: –æ–Ω–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç –∑–∞–ø–∏—Å–µ–π `MessageStatus` –∏ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç `unreadCount` –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–∏–∞–ª–æ–≥–∞.

```json
{
  "senderId": "agent_42",
  "type": "internal.text",
  "content": "–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –ø–æ–º–æ—á—å?"
}
```

```json
{
  "senderId": "agent_42",
  "type": "internal.image",
  "content": "–í–æ—Ç —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞",
  "meta": {
    "url": "https://cdn.example.com/images/item-42.jpg",
    "mimeType": "image/jpeg",
    "size": 482193,
    "width": 1280,
    "height": 720
  }
}
```

```json
{
  "senderId": "agent_42",
  "type": "internal.file",
  "meta": {
    "url": "https://cdn.example.com/docs/manual.pdf",
    "mimeType": "application/pdf",
    "size": 912344,
    "fileName": "manual.pdf"
  }
}
```
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `type` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–≤–∏—Ç—Å—è `internal.text`.
- –ü–æ–ª–µ `meta` –¥–æ–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞, –±—É–ª–µ–≤—ã, –º–∞—Å—Å–∏–≤—ã –∏ –æ–±—ä–µ–∫—Ç—ã.
- –í —Ç–µ–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫–∏ –≤ `meta` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `attachmentUrl`).

### –¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å `quotedMessageId` –¥–ª—è —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥—Ä—É–≥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –¶–∏—Ç–∏—Ä—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ–Ω–æ, –æ–±–æ–≥–∞—â–µ–Ω–æ –º–µ—Ç–∞-—Ç–µ–≥–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ (`senderInfo`), –∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –æ–±—ä–µ–∫—Ç `quotedMessage`.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `quotedMessageId` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Å—Ç—Ä–æ–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `msg_` + 20 —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `msg_7c4xtkt4bhcmfn49rjvr`). –î–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –≤ —Ç–æ–º –∂–µ tenant.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç —Ü–∏—Ç–∏—Ä—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ `quotedMessageId`.
2. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–µ—Ç–∞-—Ç–µ–≥–∏ —Ü–∏—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ (`senderInfo`).
3. –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `quotedMessage` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
   ```json
   {
     "messageId": "msg_7c4xtkt4bhcmfn49rjvr",
     "dialogId": "dlg_abc123def456ghi789j",
     "senderId": "carl",
     "content": "–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
     "type": "internal.text",
     "createdAt": 1699447823512,
     "updatedAt": 1699447823512,
     "meta": {
       "channelType": "whatsapp"
     },
     "senderInfo": {
       "userId": "carl",
       "name": "Carl Smith",
       "lastActiveAt": 1699447800000,
       "createdAt": 1699000000000,
       "updatedAt": 1699447800000,
       "meta": {
         "role": "manager"
       }
     }
   }
   ```
4. `quotedMessage` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î.
5. `quotedMessage` –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Å–æ–±—ã—Ç–∏–µ `message.create` (–≤ –ø–æ–ª–µ `data.quotedMessage`).
6. `quotedMessage` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Updates —á–µ—Ä–µ–∑ `buildFullMessagePayload`.

**–í–∞–∂–Ω–æ:**
- –ï—Å–ª–∏ —Ü–∏—Ç–∏—Ä—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ `quotedMessage` –±—É–¥–µ—Ç `null`.
- –¶–∏—Ç–∏—Ä—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–æ–º—É –∂–µ `tenantId`, —á—Ç–æ –∏ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
- `quotedMessage` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –≤–∫–ª—é—á–∞—è –º–µ—Ç–∞-—Ç–µ–≥–∏ –∏ `senderInfo`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ü–∏—Ç–∞—Ç—É –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

```bash
curl -X POST http://localhost:3000/api/dialogs/64fa1cca6f/messages \
  -H "Content-Type: application/json" \
  -H "x-api-key: <YOUR_API_KEY>" \
  -d '{
    "senderId": "agent_42",
    "type": "internal.text",
    "content": "–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –ø–æ–º–æ—á—å?",
    "meta": {
      "channelType": "whatsapp",
      "integrationId": "crm_1234",
      "externalMessageId": "crm-msg-987"
    }
  }'
```

**–ü—Ä–∏–º–µ—Ä —Å —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è:**

```bash
curl -X POST http://localhost:3000/api/dialogs/64fa1cca6f/messages \
  -H "Content-Type: application/json" \
  -H "x-api-key: <YOUR_API_KEY>" \
  -d '{
    "senderId": "agent_42",
    "type": "internal.text",
    "content": "–û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "quotedMessageId": "msg_7c4xtkt4bhcmfn49rjvr",
    "meta": {
      "channelType": "whatsapp"
    }
  }'
```

–í –æ—Ç–≤–µ—Ç–µ –∏ –≤ —Å–æ–±—ã—Ç–∏—è—Ö/updates –±—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω–æ –ø–æ–ª–µ `quotedMessage` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ü–∏—Ç–∏—Ä—É–µ–º–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.

–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç `Message` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ `Event`/`Update` –±—É–¥—É—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

---

## üêá –ü–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π (RabbitMQ `chat3_events`)

### –û–±—â–∞—è —Å—Ö–µ–º–∞

- Exchange: `chat3_events` (—Ç–∏–ø `topic`).
- Routing key: `{entityType}.{action}.{tenantId}`, –Ω–∞–ø—Ä–∏–º–µ—Ä `message.create.tnt_default`.
- –û—á–µ—Ä–µ–¥—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `chat3_events` (durable, TTL 3600000 –º—Å).
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä payload ‚Äî 256 KB.
- –°–æ–æ–±—â–µ–Ω–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –≤ MongoDB.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è

```json
{
  "_id": "6550d9ce3a2f4c4b5e0a1d22",
  "tenantId": "tnt_default",
  "eventType": "message.create",
  "entityType": "message",
  "entityId": "6550d9ce3a2f4c4b5e0a1d11",
  "actorId": "agent_42",
  "actorType": "user",
  "data": {
    "dialogId": "6550d8af9b6e9a28f4f74007",
    "dialogName": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞",
    "messageType": "internal.text",
    "content": "–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –ø–æ–º–æ—á—å?",
    "meta": {
      "channelType": "whatsapp"
    }
  },
  "metadata": {
    "ipAddress": "203.0.113.10",
    "userAgent": "ExternalService/1.0",
    "apiKeyId": "654fff125a1f0d2fbd2c92e7",
    "source": "api"
  },
  "createdAt": "2025-11-08T10:10:23.512Z"
}
```

### –ö–∞—Ç–∞–ª–æ–≥ —Å–æ–±—ã—Ç–∏–π

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°–æ–±—ã—Ç–∏—è | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|---------|-------------|
| Dialog | `dialog.create`, `dialog.update`, `dialog.delete` | –ò–º—è, —É—á–∞—Å—Ç–Ω–∏–∫–∏, –º–µ—Ç–∞-—Ç–µ–≥–∏. |
| Dialog Members | `dialog.member.add`, `dialog.member.remove`, `dialog.member.update` | –£—á–∞—Å—Ç–Ω–∏–∫, —Ä–æ–ª—å, –º–µ—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞. |
| Message | `message.create`, `message.update`, `message.delete` | –ö–æ–Ω—Ç–µ–Ω—Ç, —Ç–∏–ø, –º–µ—Ç–∞, reactions. |
| Message Status | `message.status.create`, `message.status.update` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ `unread/delivered/read`; `MessageUpdate` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `meta`, `statuses`, `senderInfo`. |
| Message Reaction | `message.reaction.add`, `message.reaction.update`, `message.reaction.remove` | –°—á—ë—Ç—á–∏–∫–∏ —Ä–µ–∞–∫—Ü–∏–π. |
| Dialog Typing | `dialog.typing` | –°–∏–≥–Ω–∞–ª –æ —Ç–æ–º, —á—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç (—ç–∫—Å–ø–∏—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ). |

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `channel.prefetch(<N>)`, —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—Ç—å `channel.ack(msg)` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ `channel.nack(msg, false, true)` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏.
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ DLX –ª–∏–±–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å ID —Å–æ–±—ã—Ç–∏—è.
- –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff; –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `amqplib` –Ω–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –∫—É—Ä—Å–æ—Ä—ã ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `eventId` –∏–ª–∏ `createdAt` –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### –ü—Ä–∏–º–µ—Ä –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ (Node.js)

```javascript
import amqp from 'amqplib';

async function subscribeToEvents() {
  const connection = await amqp.connect(process.env.RABBITMQ_URL);
  const channel = await connection.createChannel();

  const exchange = 'chat3_events';
  const queue = 'chat3_events';

  await channel.assertExchange(exchange, 'topic', { durable: true });
  await channel.assertQueue(queue, {
    durable: true,
    arguments: { 'x-message-ttl': 3600000 }
  });
  await channel.bindQueue(queue, exchange, '#');
  channel.prefetch(10);

  channel.consume(queue, (msg) => {
    if (!msg) return;
    try {
      const event = JSON.parse(msg.content.toString());
      console.log('[event]', event.eventType, event.entityId);
      // –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
      channel.ack(msg);
    } catch (err) {
      console.error('Failed to handle event', err);
      channel.nack(msg, false, true); // –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
    }
  });

  connection.on('close', () => console.warn('RabbitMQ connection closed, retrying...'));
  connection.on('error', (err) => console.error('RabbitMQ error', err));
}

subscribeToEvents().catch(console.error);
```

---

## üîÑ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (RabbitMQ `chat3_updates`)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Updates ‚Äî –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ù–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å—Ç—Ä–æ–∏—Ç –ª–µ–Ω—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–π, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫–∏ –∏ —Ç.–¥. –°–æ–∑–¥–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–æ—Ä–∫–µ—Ä–æ–º `updateWorker` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–±—ã—Ç–∏–π.

### –°—Ö–µ–º–∞

- Exchange: `chat3_updates` (topic).
- Routing key: `user.{userId}.{updateType}`.
  - `updateType = dialogupdate` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤.
  - `updateType = messageupdate` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è, —Ä–µ–∞–∫—Ü–∏–∏, —Å—Ç–∞—Ç—É—Å—ã.
- –û—á–µ—Ä–µ–¥—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –æ–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–µ—Ä–≤–∏—Å.
- Update —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ MongoDB (`updates` –∫–æ–ª–ª–µ–∫—Ü–∏—è) –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ RabbitMQ. –ü–æ–ª—è `published` –∏ `publishedAt` –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Update

```json
{
  "_id": "6550dbf73a2f4c4b5e0a1df1",
  "tenantId": "tnt_default",
  "userId": "agent_42",
  "dialogId": "6550d8af9b6e9a28f4f74007",
  "entityId": "6550d9ce3a2f4c4b5e0a1d11",
  "eventId": "6550d9ce3a2f4c4b5e0a1d22",
  "eventType": "message.create",
  "data": {
    "_id": "6550d9ce3a2f4c4b5e0a1d11",
    "senderId": "agent_42",
    "content": "–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –ø–æ–º–æ—á—å?",
    "type": "internal.text",
    "reactionCounts": {},
    "meta": {
      "channelType": "whatsapp",
      "integrationId": "crm_1234"
    },
    "createdAt": "2025-11-08T10:10:23.512Z"
  },
  "published": true,
  "publishedAt": "2025-11-08T10:10:23.640Z",
  "createdAt": "2025-11-08T10:10:23.528Z",
  "updatedAt": "2025-11-08T10:10:23.528Z"
}
```

### –ü—Ä–∞–∫—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Updates

- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `user_${userId}_queue`.
- –ü—Ä–∏–≤—è–∑—ã–≤–∞–π—Ç–µ –æ—á–µ—Ä–µ–¥—å –∫ `chat3_updates` –ø–æ –º–∞—Å–∫–µ `user.${userId}.*` –∏–ª–∏ `user.${userId}.messageupdate`.
- –£—á–∏—Ç—ã–≤–∞–π—Ç–µ, —á—Ç–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –≤–æ—Ä–∫–µ—Ä –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `published=false` => Update –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `channel.ack` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞/–±—ç–∫–µ–Ω–¥–∞.
- –î–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç–µ `eventId` –∏ `entityId`, —á—Ç–æ–±—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã.

### –ü—Ä–∏–º–µ—Ä –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ Updates

```javascript
import amqp from 'amqplib';

async function subscribeToUserUpdates(userId) {
  const connection = await amqp.connect(process.env.RABBITMQ_URL);
  const channel = await connection.createChannel();

  const exchange = 'chat3_updates';
  const queue = `user_${userId}_queue`;

  await channel.assertExchange(exchange, 'topic', { durable: true });
  await channel.assertQueue(queue, { durable: true });
  await channel.bindQueue(queue, exchange, `user.${userId}.*`);

  channel.consume(queue, (msg) => {
    if (!msg) return;
    try {
      const update = JSON.parse(msg.content.toString());
      console.log('[update]', update.eventType, update.entityId);
      // –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
      channel.ack(msg);
    } catch (err) {
      console.error('Failed to handle update', err);
      channel.nack(msg, false, true);
    }
  });
}

subscribeToUserUpdates('agent_42').catch(console.error);
```

---

## üß± –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **Backend —Å–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä–∞**:
  - –•—Ä–∞–Ω–∏—Ç API –∫–ª—é—á–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é tenant'–æ–≤.
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç REST –≤—ã–∑–æ–≤—ã (—Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤, —Å–æ–æ–±—â–µ–Ω–∏–π, –º–µ—Ç–∞-—Ç–µ–≥–æ–≤).
  - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `chat3_events` –¥–ª—è –∞—É–¥–∏—Ç–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å CRM.
  - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ `meta.integrationId`).
- **Realtime / Gateway —Å–ª–æ–π**:
  - –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `chat3_updates`.
  - –†–∞—Å—Å—ã–ª–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ WebSocket, push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ç.–¥.
  - –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ acknowledgements.
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
  - –ö—ç—à–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ updates –¥–ª—è offline; —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ `eventId`.
  - –•—Ä–∞–Ω–∏—Ç –º–∞–ø–ø–∏–Ω–≥–∏ –≤–Ω–µ—à–Ω–∏—Ö ID (CRM, —Ç–∏–∫–µ—Ç—ã).
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã**:
  - RabbitMQ: —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π, —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
  - REST: latency, error rate.
  - MongoDB: —Ä–∞–∑–º–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–π `events`, `updates`, –∏–Ω–¥–µ–∫—Å—ã.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

1. **–°–æ–∑–¥–∞—Ç—å API –∫–ª—é—á** –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ.
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ**: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è MongoDB, RabbitMQ, API.
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: –≤—ã–ø–æ–ª–Ω–∏—Ç—å `GET /api/dialogs`.
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å retry-–ø–æ–ª–∏—Ç–∏–∫—É** –¥–ª—è REST (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã).
5. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `chat3_events`** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.
6. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ `chat3_updates`** –¥–ª—è —Ü–µ–ª–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —É–±–µ–¥–∏—Ç—å—Å—è –≤ –¥–æ—Å—Ç–∞–≤–∫–µ.
7. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –æ—á–µ—Ä–µ–¥–µ–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–ª–µ—Ä—Ç—ã –ø–æ –æ—à–∏–±–∫–∞–º.
8. **–ü–æ–∫—Ä—ã—Ç—å QA-—Å—Ü–µ–Ω–∞—Ä–∏–∏** (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `mongodb-memory-server` + `@onify/fake-amqplib` –∫–∞–∫ –≤ –ø—Ä–æ–µ–∫—Ç–µ).
9. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å** API –∏ —Å–æ–±—ã—Ç–∏–π, –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–ª–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–π.
10. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–ª—é—á–∏** (—Ä–æ—Ç–∞—Ü–∏—è, –æ—Ç–∑—ã–≤ –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏).

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- `docs/API.md` ‚Äî –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ REST —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏.
- `docs/FILTER_RULES.md` ‚Äî —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã.
- `docs/EVENTS.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π.
- `docs/UPDATES.md` ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ Updates.
- `docs/TIMESTAMP_USAGE.md` ‚Äî –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ —Ç–æ—á–Ω–æ—Å—Ç—å—é.
- `docs/FINAL_ID_FIXES.md` ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –º–∏–≥—Ä–∞—Ü–∏–π.

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥–∞ Chat3 –º–æ–∂–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.

